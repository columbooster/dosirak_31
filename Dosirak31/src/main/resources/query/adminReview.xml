<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dosirak31.admin.review.dao.AdminReviewDao">
	
	<!-- 관리자 페이지 조회 -->
	<select id="adminReviewList" parameterType="AdminReview" resultType="AdminReview">
		<![CDATA[	 
     	 SELECT review_no, review_contents, review_score, client_no, order_no,
   		 review_name, to_char(review_date, 'YYYY-MM-DD HH24:MI:ss') as review_date
		 FROM ( SELECT /*+ INDEX_DESC(review review_pk) */
		 		       rownum as rnum, review_no, review_contents, review_score,
		 		       r.client_no as client_no, r.order_no as order_no, review_name,
		 		       review_date
		 FROM review r 
		 INNER JOIN orders o 
		 on r.order_no=o.order_no WHERE ]]>
		 <![CDATA[ o.order_status_no = 3 and rownum <= #{pageNum} * #{amount}    
                ) reviewList
     	 WHERE rnum >(#{pageNum} - 1) * #{amount}
     	 ]]>
	</select>
	
	<!-- 관리자 페이지 전체 레코드 수 조회 -->
	<select id="adminReviewListCnt" parameterType="AdminReview" resultType="int">
		SELECT count(*) FROM review
	</select>
</mapper>