<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dosirak31.food.review.dao.FoodReviewDao">
	
	<!-- 리뷰 게시판 기본 조회 -->
	<select id="foodReviewList" parameterType="review" resultType="review">
		SELECT review_no, review_contents, review_score, r.client_no, r.order_no,
      	review_name, to_char(review_date, 'YYYY-MM-DD HH24:MI:ss') as review_date, page_no
     	 FROM review r
     	 INNER JOIN orders o
     	 on r.order_no=o.order_no
     	 WHERE o.order_status_no = 3 and page_no = #{page_no}
	</select>
	
	<!-- 댓글 등록 -->
	<insert id="foodReviewInsert" parameterType="review">
		<selectKey keyProperty="review_no" resultType="int" order="BEFORE">
			select Review_seq.nextval from dual	
		</selectKey> 
		insert into Review(review_no, review_name, review_contents, review_score,)
		values(#{review_no}, #{review_name}, #{review_contents}, #{review_score})
	</insert>
	
	<!-- 리뷰 게시판 삭제 -->
	<delete id= "foodReviewDelete" parameterType="review">
		delete from review where review_no = #{review_no}
	</delete>
	
	<!-- 리뷰 게시판 수정 -->
	<update id= "foodReviewUpdate" parameterType="review">
		UPDATE review
		SET review_name = #{review_name}
			review_score = #{review_score}
			review_contents = #{review_contents}
			review_date = sysdate
		WHERE review_no = #{review_no}	
	</update>
	
</mapper>