<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dosirak31.mypage.review.dao.MypageReviewDao">
	
	<!-- 회원 정보 -->
	<select id="mypageList" parameterType="mypage" resultType="mypage">
		SELECT client_no, client_id, client_name
		FROM client
		WHERE client_no = #{client_no}
	</select>
	
	<!-- 자신의 리뷰 목록 -->
	<!-- <select id="mypageReviewList" parameterType="mypage" resultType="mypage">
		SELECT review_no, review_contents, review_score, c.client_no,
      	review_name, to_char(review_date, 'YYYY-MM-DD HH24:MI:ss') as review_date
     	FROM review r
     	INNER JOIN client c
     	on r.client_no = c.client_no
     	WHERE c.client_no = #{client_no}
     	ORDER BY r.review_no desc
	</select> -->
	
	<!-- 리뷰 목록 (페이징 처리) -->
	<select id="mypageReviewList" parameterType="mypage" resultType="mypage">
	<![CDATA[
		SELECT review_no, review_contents, review_score, client_no,
      	review_name, to_char(review_date, 'YYYY-MM-DD HH24:MI:ss') as review_date
     	FROM ( select
     		rownum as rnum, review_no, review_contents, review_score, c.client_no,
      		review_name, review_date
      		from review r
   		INNER JOIN client c
     	on r.client_no = c.client_no WHERE]]>
     		c.client_no = #{client_no} and
     		<![CDATA[ rownum<=#{pageNum}*#{amount}
     		ORDER BY r.review_no desc
     	) reviewList
     	where rnum>(#{pageNum}-1)*#{amount}
     	]]>
    </select>
    
    <!-- 전체 레코드 수 조회 -->
    <select id="mypageReviewListCnt" parameterType="mypage" resultType="int">
    	SELECT count(*) FROM review
    </select>
	
	<!-- 자신의 리뷰 삭제 -->
	<delete id="mypageReviewDelete" parameterType="mypage">
		DELETE from review where review_no = #{review_no}
	</delete>
	
	<!-- 상세페이지 -->
	<select id="mypageReviewDetail" parameterType="mypage" resultType="mypage">
		SELECT
				review_no, review_contents, review_score, client_no, review_name,
      			to_char(review_date, 'YYYY-MM-DD HH24:MI:ss') as review_date
     	FROM review
     	WHERE review_no = ${review_no} 
	</select>
	
	<!-- 리뷰  수정 -->
	<update id="mypageReviewUpdate" parameterType="mypage">
		UPDATE review
		SET review_score = #{review_score},
			review_contents = #{review_contents}
		WHERE review_no = #{review_no}
	</update>
</mapper>